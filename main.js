(()=>{"use strict";var e={122:function(e,o){var t=this&&this.__read||function(e,o){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var r,n,i=t.call(e),a=[];try{for(;(void 0===o||o-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(n)throw n.error}}return a},r=this&&this.__spread||function(){for(var e=[],o=0;o<arguments.length;o++)e=e.concat(t(arguments[o]));return e};function n(e){return 0===e["王"]["黒"]&&0===e["王"]["赤"]?function(e){function o(o){return e[o]["赤"]+e[o]["黒"]>0}function t(o){return e[o]["赤"]+e[o]["黒"]}var r=new Set;e["兵"]["赤"]>=5||e["兵"]["黒"]>=5?r.add("同色闇戦之集"):t("兵")>=5&&r.add("闇戦之集"),e["車"]["赤"]>=1&&e["兵"]["赤"]>=2||e["車"]["黒"]>=1&&e["兵"]["黒"]>=2?r.add("同色助友"):o("車")&&t("兵")>=2&&r.add("助友"),e["将"]["赤"]>=1&&e["兵"]["赤"]>=2||e["将"]["黒"]>=1&&e["兵"]["黒"]>=2?r.add("同色戦集"):o("将")&&t("兵")>=2&&r.add("戦集");var n=function(t,n,i){var a;(a=t).every((function(o){return e[o]["赤"]>=1}))||a.every((function(o){return e[o]["黒"]>=1}))?r.add(n):function(e){return e.every(o)}(t)&&r.add(i)};return n(["虎","馬"],"同色獣","獣"),n(["船","車","馬"],"同色行行","行行"),n(["兵","弓","馬"],"同色馬弓兵","馬弓兵"),n(["筆","巫","将"],"同色地心","地心"),n(["兵","弓","将","筆","巫"],"同色筆兵無傾","筆兵無傾"),r}(e):function(e){function o(o){return e[o]["赤"]+e[o]["黒"]>0}var t=new Set(["王"]);t.add("王");var i,a=["兵","弓","車","虎","馬","筆","巫","将","船"];(i=r(a,["王"])).every((function(o){return e[o]["赤"]>=1}))||i.every((function(o){return e[o]["黒"]>=1}))?t.add("同色無抗行処"):function(e){return e.every(o)}(r(a,["王"]))&&t.add("無抗行処");var l=function(o){if(1===e["王"][o]){e["王"][o]--;for(var i=0;i<a.length;i++)e[a[i]][o]++,t=new Set(r(t,n(e))),e[a[i]][o]--;e["王"][o]++}};l("赤"),l("黒");var s=function(e,o){t.has(e)&&t.delete(o)};return s("同色助友","助友"),s("同色地心","地心"),s("同色戦集","戦集"),s("同色馬弓兵","馬弓兵"),s("同色獣","獣"),s("同色行行","行行"),s("同色筆兵無傾","筆兵無傾"),s("同色闇戦之集","闇戦之集"),s("同色無抗行処","無抗行処"),t}(e)}Object.defineProperty(o,"__esModule",{value:!0}),o.toObtainablePieces2={黒兵:{color:"黒",prof:"兵"},赤兵:{color:"赤",prof:"兵"},黒弓:{color:"黒",prof:"弓"},黒車:{color:"黒",prof:"車"},黒虎:{color:"黒",prof:"虎"},黒馬:{color:"黒",prof:"馬"},黒筆:{color:"黒",prof:"筆"},黒巫:{color:"黒",prof:"巫"},黒将:{color:"黒",prof:"将"},赤弓:{color:"赤",prof:"弓"},赤車:{color:"赤",prof:"車"},赤虎:{color:"赤",prof:"虎"},赤馬:{color:"赤",prof:"馬"},赤筆:{color:"赤",prof:"筆"},赤巫:{color:"赤",prof:"巫"},赤将:{color:"赤",prof:"将"},黒王:{color:"黒",prof:"王"},赤王:{color:"赤",prof:"王"},黒船:{color:"黒",prof:"船"},赤船:{color:"赤",prof:"船"}},o.hand_to_score={無抗行処:50,同色無抗行処:52,筆兵無傾:10,同色筆兵無傾:12,地心:7,同色地心:9,馬弓兵:5,同色馬弓兵:7,行行:5,同色行行:7,王:5,獣:3,同色獣:5,戦集:3,同色戦集:5,助友:3,同色助友:5,闇戦之集:3,同色闇戦之集:5,皇再来:-3,撃皇:-5},o.calculate_hands_and_score_from_pieces=function(e){var t=function(e){for(var t=e.map((function(e){return o.toObtainablePieces2[e]})),i={兵:{黒:0,赤:0},弓:{黒:0,赤:0},車:{黒:0,赤:0},虎:{黒:0,赤:0},馬:{黒:0,赤:0},筆:{黒:0,赤:0},巫:{黒:0,赤:0},将:{黒:0,赤:0},王:{黒:0,赤:0},船:{黒:0,赤:0}},a=0;a<t.length;a++)i[t[a].prof][t[a].color]++;var l=[];return i["兵"]["黒"]>8&&l.push("黒兵"),i["兵"]["赤"]>8&&l.push("赤兵"),i["弓"]["黒"]>2&&l.push("黒弓"),i["弓"]["赤"]>2&&l.push("赤弓"),i["車"]["黒"]>2&&l.push("黒車"),i["車"]["赤"]>2&&l.push("赤車"),i["虎"]["黒"]>2&&l.push("黒虎"),i["虎"]["赤"]>2&&l.push("赤虎"),i["馬"]["黒"]>2&&l.push("黒馬"),i["馬"]["赤"]>2&&l.push("赤馬"),i["筆"]["黒"]>2&&l.push("黒筆"),i["筆"]["赤"]>2&&l.push("赤筆"),i["巫"]["黒"]>2&&l.push("黒巫"),i["巫"]["赤"]>2&&l.push("赤巫"),i["将"]["黒"]>2&&l.push("黒将"),i["将"]["赤"]>2&&l.push("赤将"),i["王"]["黒"]>1&&l.push("黒王"),i["王"]["赤"]>1&&l.push("赤王"),i["船"]["黒"]>1&&l.push("黒船"),i["船"]["赤"]>1&&l.push("赤船"),l.length>0?{too_many:l}:r(n(i))}(e);return Array.isArray(t)?{error:!1,score:t.map((function(e){return o.hand_to_score[e]})).reduce((function(e,o){return e+o}),0),hands:t}:{error:!0,too_many:t.too_many}},o.generate_example=function(e){for(var o,r=["黒兵","黒兵","黒兵","黒兵","黒兵","黒兵","黒兵","黒兵","赤兵","赤兵","赤兵","赤兵","赤兵","赤兵","赤兵","赤兵","黒弓","黒車","黒虎","黒馬","黒筆","黒巫","黒将","黒弓","黒車","黒虎","黒馬","黒筆","黒巫","黒将","赤弓","赤車","赤虎","赤馬","赤筆","赤巫","赤将","赤弓","赤車","赤虎","赤馬","赤筆","赤巫","赤将","黒王","赤王","黒船","赤船"],n=r.length-1;n>0;n--){var i=Math.floor(Math.random()*(n+1));o=t([r[i],r[n]],2),r[n]=o[0],r[i]=o[1]}return r.slice(0,e)}},431:(e,o,t)=>{Object.defineProperty(o,"__esModule",{value:!0}),function(e){for(var t in e)o.hasOwnProperty(t)||(o[t]=e[t])}(t(122))},974:function(e,o,t){var r=this&&this.__createBinding||(Object.create?function(e,o,t,r){void 0===r&&(r=t),Object.defineProperty(e,r,{enumerable:!0,get:function(){return o[t]}})}:function(e,o,t,r){void 0===r&&(r=t),e[r]=o[t]}),n=this&&this.__exportStar||function(e,o){for(var t in e)"default"===t||o.hasOwnProperty(t)||r(o,e,t)};Object.defineProperty(o,"__esModule",{value:!0}),n(t(101),o)},101:(e,o)=>{var t,r;Object.defineProperty(o,"__esModule",{value:!0}),o.Profession=o.Color=void 0,(r=o.Color||(o.Color={}))[r.Kok1=0]="Kok1",r[r.Huok2=1]="Huok2",(t=o.Profession||(o.Profession={}))[t.Nuak1=0]="Nuak1",t[t.Kauk2=1]="Kauk2",t[t.Gua2=2]="Gua2",t[t.Kaun1=3]="Kaun1",t[t.Dau2=4]="Dau2",t[t.Maun1=5]="Maun1",t[t.Kua2=6]="Kua2",t[t.Tuk2=7]="Tuk2",t[t.Uai1=8]="Uai1",t[t.Io=9]="Io"},945:(e,o,t)=>{Object.defineProperty(o,"__esModule",{value:!0});const r=t(233),n=t(974);function i(e,o){const[t,r]=e;return o.map((([e,o])=>[t+e,r+o])).filter((([e,o])=>0<=e&&e<=8&&0<=o&&o<=8)).map((([e,o])=>[e,o]))}function a(e){const[o,t]=e,r=[];for(let e=-8;e<=8;e++)for(let n=-8;n<=8;n++)o*n-t*e==0&&(o*e+t*n<=0||e*e+n*n>=o*o+t*t||(r[r.length]=[e,n]));return r}function l(e,o,t){return[].concat(...o.map((o=>s(e,o,t))))}function s(e,o,t){return i(e,a(o)).every((([e,o])=>null==t[e][o]))?i(e,[o]):[]}function d(e,o,t){return[].concat(...o.map((o=>function(e,o,t){return i(e,a(o)).filter((([e,o])=>null!=t[e][o])).length<=1?i(e,[o]):[]}(e,o,t))))}function c(e){return i(e,[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]])}function u(e,o,t){return!!(r.coordEq(e,[2,2])||r.coordEq(e,[2,6])||r.coordEq(e,[3,3])||r.coordEq(e,[3,5])||r.coordEq(e,[4,4])||r.coordEq(e,[5,3])||r.coordEq(e,[5,5])||r.coordEq(e,[6,2])||r.coordEq(e,[6,6]))||!(!t||"Tam2"!==o[e[0]][e[1]])||c(e).some((([e,t])=>"Tam2"===o[e][t]))}function f(e,o,t,r){const[i,a]=o,l=t[i][a];return"Tam2"!==l&&(null===l||l.side!==e&&!((e,o)=>c(o).filter((([o,i])=>{const a=t[o][i];return null!=a&&"Tam2"!==a&&a.prof===n.Profession.Uai1&&a.side!==e&&u([o,i],t,r)})).length>0)(e,o))}console.assert("[[-4,2],[-2,1]]"===JSON.stringify(a([-6,3]))),console.assert("[[-2,0],[-1,0]]"===JSON.stringify(a([-3,0]))),console.assert("[[0,1],[0,2]]"===JSON.stringify(a([0,3]))),o.eightNeighborhood=c,o.isTamHue=u,o.canGetOccupiedBy=function(e,o,t,r,n){if("Tam2"===t){const[e,t]=o;return null===r[e][t]}return f(e,o,r,n)},o.canGetOccupiedByNonTam=f,o.calculateMovablePositions=function(e,o,t,r){if("Tam2"===o)return{finite:c(e),infinite:[]};if(o.prof===n.Profession.Io)return{finite:c(e),infinite:[]};const f=[[-8,-8],[-7,-7],[-6,-6],[-5,-5],[-4,-4],[-3,-3],[-2,-2],[-1,-1]],p=[[-8,8],[-7,7],[-6,6],[-5,5],[-4,4],[-3,3],[-2,2],[-1,1]],_=[[8,-8],[7,-7],[6,-6],[5,-5],[4,-4],[3,-3],[2,-2],[1,-1]],m=[[8,8],[7,7],[6,6],[5,5],[4,4],[3,3],[2,2],[1,1]],w=[[-1,0],[-2,0],[-3,0],[-4,0],[-5,0],[-6,0],[-7,0],[-8,0]],E=[[1,0],[2,0],[3,0],[4,0],[5,0],[6,0],[7,0],[8,0]],A=[[0,-1],[0,-2],[0,-3],[0,-4],[0,-5],[0,-6],[0,-7],[0,-8]],y=[[0,1],[0,2],[0,3],[0,4],[0,5],[0,6],[0,7],[0,8]];if(u(e,t,r))switch(o.prof){case n.Profession.Uai1:return{finite:c(e),infinite:[]};case n.Profession.Kaun1:return{finite:i(e,[[-2,-2],[-2,2],[2,2],[2,-2]]),infinite:[]};case n.Profession.Kauk2:return{finite:[...i(e,[[-1,0],[0,-1],[0,1],[1,0]]),...s(e,[-2,0],t)],infinite:[]};case n.Profession.Nuak1:return{finite:[...i(e,[[0,-1],[0,1]]),...l(e,[[0,-2],[0,2]],t)],infinite:l(e,[...w,...E],t)};case n.Profession.Gua2:case n.Profession.Dau2:return{finite:[],infinite:l(e,[...f,...p,..._,...m],t)};case n.Profession.Maun1:{const o=[[-8,-8],[-7,-7],[-6,-6],[-5,-5],[-4,-4],[-3,-3],[-2,-2],[-8,8],[-7,7],[-6,6],[-5,5],[-4,4],[-3,3],[-2,2],[8,-8],[7,-7],[6,-6],[5,-5],[4,-4],[3,-3],[2,-2],[8,8],[7,7],[6,6],[5,5],[4,4],[3,3],[2,2]];let r=[];for(let n=0;n<o.length;n++){const l=o[n];i(e,a(l).filter((e=>!([-1,1].includes(e[0])&&[-1,1].includes(e[1]))))).every((([e,o])=>null==t[e][o]))&&(r=[...r,...i(e,[l])])}return{finite:[],infinite:r}}case n.Profession.Kua2:return{finite:[],infinite:l(e,[...w,...E,...A,...y],t)};case n.Profession.Tuk2:return{finite:[],infinite:d(e,[...w,...E,...A,...y,...f,...p,..._,...m],t)};default:return o.prof}else switch(o.prof){case n.Profession.Kauk2:return{finite:i(e,[[-1,0]]),infinite:[]};case n.Profession.Kaun1:return{finite:i(e,[[-2,0],[2,0],[0,-2],[0,2]]),infinite:[]};case n.Profession.Dau2:return{finite:i(e,[[-1,-1],[-1,1],[1,-1],[1,1]]),infinite:[]};case n.Profession.Maun1:return{finite:i(e,[[-2,-2],[-2,2],[2,2],[2,-2]]),infinite:[]};case n.Profession.Nuak1:return{finite:[],infinite:l(e,w,t)};case n.Profession.Gua2:return{finite:[],infinite:l(e,[...w,...E,...A,...y],t)};case n.Profession.Kua2:return{finite:i(e,[[0,-1],[0,1]]),infinite:l(e,[...w,...E],t)};case n.Profession.Tuk2:return{finite:i(e,[[-1,0],[1,0]]),infinite:l(e,[...A,...y],t)};case n.Profession.Uai1:return{finite:i(e,[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,1]]),infinite:[]};default:return o.prof}}},247:(e,o,t)=>{Object.defineProperty(o,"__esModule",{value:!0});const r=t(233),n=t(974);o.initial_board_with_IA_down=[[{color:n.Color.Huok2,prof:n.Profession.Kua2,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Maun1,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Kaun1,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Uai1,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Io,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Uai1,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Kaun1,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Maun1,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Kua2,side:r.Side.Downward}],[{color:n.Color.Kok1,prof:n.Profession.Tuk2,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Gua2,side:r.Side.Downward},null,{color:n.Color.Kok1,prof:n.Profession.Dau2,side:r.Side.Downward},null,{color:n.Color.Huok2,prof:n.Profession.Dau2,side:r.Side.Downward},null,{color:n.Color.Huok2,prof:n.Profession.Gua2,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Tuk2,side:r.Side.Downward}],[{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Nuak1,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Downward}],[null,null,null,null,null,null,null,null,null],[null,null,null,null,"Tam2",null,null,null,null],[null,null,null,null,null,null,null,null,null],[{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Nuak1,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Upward}],[{color:n.Color.Huok2,prof:n.Profession.Tuk2,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Gua2,side:r.Side.Upward},null,{color:n.Color.Huok2,prof:n.Profession.Dau2,side:r.Side.Upward},null,{color:n.Color.Kok1,prof:n.Profession.Dau2,side:r.Side.Upward},null,{color:n.Color.Kok1,prof:n.Profession.Gua2,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Tuk2,side:r.Side.Upward}],[{color:n.Color.Kok1,prof:n.Profession.Kua2,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Maun1,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Kaun1,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Uai1,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Io,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Uai1,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Kaun1,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Maun1,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Kua2,side:r.Side.Upward}]]},892:(e,o,t)=>{function r(e){for(var t in e)o.hasOwnProperty(t)||(o[t]=e[t])}Object.defineProperty(o,"__esModule",{value:!0}),r(t(945)),r(t(247)),r(t(696)),r(t(233))},696:(e,o,t)=>{Object.defineProperty(o,"__esModule",{value:!0});const r=t(233),n=t(974),i=t(945);function a([e,o],t){return[["A","E","I","U","O","Y","AI","AU","IA"][t?e:8-e],["K","L","N","T","Z","X","C","M","P"][t?o:8-o]]}function l([e,o]){return 4===e&&2===o||4===e&&3===o||4===e&&4===o||4===e&&5===o||4===e&&6===o||2===e&&4===o||3===e&&4===o||5===e&&4===o||6===e&&4===o}o.toAbsoluteCoord_=a,o.fromAbsoluteCoord_=function([e,o],t){let r,n;if("A"===e)r=0;else if("E"===e)r=1;else if("I"===e)r=2;else if("U"===e)r=3;else if("O"===e)r=4;else if("Y"===e)r=5;else if("AI"===e)r=6;else if("AU"===e)r=7;else{if("IA"!==e)throw new Error("does not happen");r=8}if("K"===o)n=0;else if("L"===o)n=1;else if("N"===o)n=2;else if("T"===o)n=3;else if("Z"===o)n=4;else if("X"===o)n=5;else if("C"===o)n=6;else if("M"===o)n=7;else{if("P"!==o)throw new Error("does not happen");n=8}return t?[r,n]:[8-r,8-n]},o.isWaterAbs=function([e,o]){return"O"===e&&"N"===o||"O"===e&&"T"===o||"O"===e&&"Z"===o||"O"===e&&"X"===o||"O"===e&&"C"===o||"I"===e&&"Z"===o||"U"===e&&"Z"===o||"Y"===e&&"Z"===o||"AI"===e&&"Z"===o},o.isWater=l;const s=[0,1,2,3,4,5,6,7,8];o.get_opponent_pieces_rotated=e=>s.flatMap((o=>s.flatMap((t=>{const n=[o,t],i=e.f.currentBoard[o][t];return null===i?[]:"Tam2"===i?[{rotated_piece:i,rotated_coord:r.rotateCoord(n)}]:i.side===r.Side.Downward?[{rotated_piece:{prof:i.prof,color:i.color,side:r.Side.Upward},rotated_coord:r.rotateCoord(n)}]:[]})))),o.empty_squares=e=>s.flatMap((o=>s.flatMap((t=>{const r=[o,t];return null==e.f.currentBoard[o][t]?[r]:[]}))));const d=(e,o)=>i.eightNeighborhood(o).filter((([o,t])=>null==e[o][t]));o.from_hand_candidates=e=>e.f.hop1zuo1OfDownward.flatMap((t=>o.empty_squares(e).flatMap((o=>[{type:"NonTamMove",data:{type:"FromHand",color:t.color,prof:t.prof,dest:a(o,e.IA_is_down)}}])))),o.not_from_hand_candidates_=(e,t)=>o.get_opponent_pieces_rotated(t).flatMap((({rotated_piece:o,rotated_coord:s})=>{const{finite:c,infinite:u}=i.calculateMovablePositions(s,o,r.rotateBoard(t.f.currentBoard),t.tam_itself_is_tam_hue),f=[...c.map(r.rotateCoord),...u.map(r.rotateCoord)],p=r.rotateCoord(s);return f.flatMap((c=>{function u(e,o,t){return l(e)&&!l(t)&&o!==n.Profession.Nuak1}const f=t.f.currentBoard[c[0]][c[1]],_=e=>{const o=c,n=r.rotateBoard(t.f.currentBoard);n[s[0]][s[1]]=null;const{finite:l,infinite:d}=i.calculateMovablePositions(r.rotateCoord(o),e,n,t.tam_itself_is_tam_hue),f=l.map(r.rotateCoord),_=d.map(r.rotateCoord);return[...f.flatMap((l=>i.canGetOccupiedBy(r.Side.Downward,l,{color:e.color,prof:e.prof,side:r.Side.Downward},r.rotateBoard(n),t.tam_itself_is_tam_hue)?[{type:"NonTamMove",data:{type:"SrcStepDstFinite",src:a(p,t.IA_is_down),step:a(o,t.IA_is_down),dest:a(l,t.IA_is_down),is_water_entry_ciurl:u(l,e.prof,p)}}]:[])),..._.flatMap((l=>i.canGetOccupiedBy(r.Side.Downward,l,{color:e.color,prof:e.prof,side:r.Side.Downward},r.rotateBoard(n),t.tam_itself_is_tam_hue)?[{type:"InfAfterStep",src:a(p,t.IA_is_down),step:a(o,t.IA_is_down),plannedDirection:a(l,t.IA_is_down),stepping_ciurl:null,finalResult:null}]:[]))]};if("Tam2"===o){const e=r.rotateBoard(t.f.currentBoard);if(e[s[0]][s[1]]=null,null===f){const o=c;return i.eightNeighborhood(o).flatMap((n=>{if(null==t.f.currentBoard[n[0]][n[1]]||r.coordEq(n,p))return[{type:"TamMove",stepStyle:"NoStep",secondDest:a(n,t.IA_is_down),firstDest:a(o,t.IA_is_down),src:a(p,t.IA_is_down)}];{const i=n;return d(r.rotateBoard(e),i).flatMap((e=>[{type:"TamMove",stepStyle:"StepsDuringLatter",firstDest:a(o,t.IA_is_down),secondDest:a(e,t.IA_is_down),src:a(p,t.IA_is_down),step:a(i,t.IA_is_down)}]))}}))}{const o=c;return d(r.rotateBoard(e),o).flatMap((n=>d(r.rotateBoard(e),n).flatMap((e=>[{type:"TamMove",stepStyle:"StepsDuringFormer",firstDest:a(n,t.IA_is_down),secondDest:a(e,t.IA_is_down),src:a(p,t.IA_is_down),step:a(o,t.IA_is_down)}]))))}}return null===f?[{type:"NonTamMove",data:{type:"SrcDst",src:a(p,t.IA_is_down),dest:a(c,t.IA_is_down),is_water_entry_ciurl:u(c,o.prof,p)}}]:"Tam2"===f?e.allow_kut2tam2?_(o):[]:f.side===r.Side.Upward&&i.canGetOccupiedBy(r.Side.Downward,c,{color:o.color,prof:o.prof,side:r.Side.Downward},t.f.currentBoard,t.tam_itself_is_tam_hue)?[{type:"NonTamMove",data:{type:"SrcDst",src:a(p,t.IA_is_down),dest:a(c,t.IA_is_down),is_water_entry_ciurl:u(c,o.prof,p)}},..._(o)]:_(o)}))})),o.not_from_hand_candidates=e=>o.not_from_hand_candidates_({allow_kut2tam2:!1},e),o.not_from_hand_candidates_with_kut2tam2=e=>o.not_from_hand_candidates_({allow_kut2tam2:!0},e),o.get_valid_opponent_moves=function(e){return[...o.from_hand_candidates(e),...o.not_from_hand_candidates_({allow_kut2tam2:!1},e)]}},233:(e,o)=>{var t;Object.defineProperty(o,"__esModule",{value:!0}),function(e){e[e.Upward=0]="Upward",e[e.Downward=1]="Downward"}(t=o.Side||(o.Side={})),o.fromUpOrDown=function(e){return{color:e.color,prof:e.prof,side:e.side}},o.toUpOrDown=function(e){return e.side,t.Downward,{color:e.color,prof:e.prof,side:e.side}},o.coordEq=function(e,o){return e[0]===o[0]&&e[1]===o[1]},o.rotateCoord=function(e){return[8-e[0],8-e[1]]},o.rotateBoard=function(e){const o=[[null,null,null,null,null,null,null,null,"Tam2"],[null,null,null,null,null,null,null,null,"Tam2"],[null,null,null,null,null,null,null,null,"Tam2"],[null,null,null,null,null,null,null,null,"Tam2"],[null,null,null,null,null,null,null,null,"Tam2"],[null,null,null,null,null,null,null,null,"Tam2"],[null,null,null,null,null,null,null,null,"Tam2"],[null,null,null,null,null,null,null,null,"Tam2"],[null,null,null,null,null,null,null,null,"Tam2"]];for(let r=0;r<9;r++)for(let n=0;n<9;n++)o[r][n]=null===(t=e[8-r][8-n])||"Tam2"===t?t:{prof:t.prof,color:t.color,side:1-t.side};var t;return o}},728:(e,o,t)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.createImageButton=o.createPieceImgToBePlacedOnBoard=o.createPieceImgToBePlacedOnHop1zuo1=o.createCiurl=o.createCircleGuideImageAt=o.createPieceSizeSelectionButtonOnBoard_Shifted=o.createPieceSizeImageOnBoardByPath_Shifted=o.createCancelButton=o.createPieceSizeImageOnBoardByPath=o.createPieceSizeImageOnBoardByPathAndXY=o.createArrowPiece=void 0;const r=t(460),n=t(495);function i(e,o,t,r){const i=document.createElement("img");return i.setAttribute("draggable","false"),i.classList.add(r),i.style.top=`${e}px`,i.style.left=`${o}px`,i.src=`image/${t}.png`,i.width=n.PIECE_SIZE,i.height=n.PIECE_SIZE,i}function a(e,o,t){const{top:r,left:a}=n.coordToPieceXY(e);return i(r,a,o,t)}function l(e,o,t){const{top:r,left:a}=n.coordToPieceXY_Shifted(e);return i(r,a,o,t)}o.createArrowPiece=function(e,o){const[t,r]=o,i=1+t*n.BOX_SIZE+159.5,a=r*n.BOX_SIZE+19.25,l=document.createElement("img");return l.classList.add("selection"),l.style.top=`${i}px`,l.style.left=`${a}px`,l.src=`image/${e}.png`,l.width=140,l.height=140,l},o.createPieceSizeImageOnBoardByPathAndXY=i,o.createPieceSizeImageOnBoardByPath=a,o.createCancelButton=function(){return i(1+9*n.BOX_SIZE+(n.MAX_PIECE_SIZE-n.PIECE_SIZE),1+7.5*n.BOX_SIZE,"piece/bmun","piece_image_on_board")},o.createPieceSizeImageOnBoardByPath_Shifted=l,o.createPieceSizeSelectionButtonOnBoard_Shifted=function(e){const o=l(e,"selection2","selection");return o.style.cursor="pointer",o.style.zIndex="200",o},o.createCircleGuideImageAt=function(e,o){const[t,r]=e,i=document.createElement("img");return i.setAttribute("draggable","false"),i.classList.add("guide"),i.style.top=1+t*n.BOX_SIZE+(n.MAX_PIECE_SIZE-n.MAX_PIECE_SIZE)/2+"px",i.style.left=1+r*n.BOX_SIZE+(n.MAX_PIECE_SIZE-n.MAX_PIECE_SIZE)/2+"px",i.src=`image/${o}.png`,i.width=n.MAX_PIECE_SIZE,i.height=n.MAX_PIECE_SIZE,i.style.cursor="pointer",i.style.opacity="0.3",i},o.createCiurl=function(e,o){const t=document.createElement("img");return t.setAttribute("draggable","false"),t.src=`image/ciurl_${e}.png`,t.width=150,t.height=15,t.classList.add("ciurl"),t.style.left=`${o.left}px`,t.style.top=`${o.top}px`,t.style.zIndex="300",t.style.transform=`rotate(${o.rotateDeg}deg)`,t.style.position="absolute",t},o.createPieceImgToBePlacedOnHop1zuo1=function(e,o){return i(1+(n.MAX_PIECE_SIZE-n.PIECE_SIZE)/2,n.indToHop1Zuo1Horizontal(e),o,"piece_image_on_hop1zuo1")},o.createPieceImgToBePlacedOnBoard=function(e,o){return a(e,r.toPath_(o),"piece_image_on_board")},o.createImageButton=function(e,o){const t=document.createElement("input");return t.setAttribute("type","image"),t.src=`image/${e}.png`,t.height=200,t.style.backgroundColor="#e0e0e0",t.style.position="absolute",t.style.left="660px",t.style.top=`${o}px`,t.style.border="1px solid #aaaaaa",t}},935:(e,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.DICTIONARY=void 0,o.DICTIONARY={ja:{whetherToTake:"駒を取る → [OK]\n駒を踏む → [Cancel]",failedWaterEntry:"入水判定に失敗しました。",newSeason:["","季節が改まり夏になりました。","季節が改まり秋になりました。","季節が改まり冬になりました。"],gameEnd:"試合終了です。"}}},392:(e,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.API_ORIGIN=void 0,o.API_ORIGIN="https://serene-reef-96808.herokuapp.com"},513:(e,o,t)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.GAME_STATE=o.initial_board_with_IA_down=o.fromAbsoluteCoord=o.toAbsoluteCoord=void 0;const r=t(892),n=t(974),i=t(519),a=t(892);o.toAbsoluteCoord=function(e){return a.toAbsoluteCoord_(e,o.GAME_STATE.IA_is_down)},o.fromAbsoluteCoord=function(e){return a.fromAbsoluteCoord_(e,o.GAME_STATE.IA_is_down)},o.initial_board_with_IA_down=[[{color:n.Color.Huok2,prof:n.Profession.Kua2,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Maun1,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Kaun1,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Uai1,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Io,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Uai1,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Kaun1,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Maun1,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Kua2,side:r.Side.Downward}],[{color:n.Color.Kok1,prof:n.Profession.Tuk2,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Gua2,side:r.Side.Downward},null,{color:n.Color.Kok1,prof:n.Profession.Dau2,side:r.Side.Downward},null,{color:n.Color.Huok2,prof:n.Profession.Dau2,side:r.Side.Downward},null,{color:n.Color.Huok2,prof:n.Profession.Gua2,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Tuk2,side:r.Side.Downward}],[{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Nuak1,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Downward},{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Downward}],[null,null,null,null,null,null,null,null,null],[null,null,null,null,"Tam2",null,null,null,null],[null,null,null,null,null,null,null,null,null],[{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Nuak1,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Kauk2,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Kauk2,side:r.Side.Upward}],[{color:n.Color.Huok2,prof:n.Profession.Tuk2,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Gua2,side:r.Side.Upward},null,{color:n.Color.Huok2,prof:n.Profession.Dau2,side:r.Side.Upward},null,{color:n.Color.Kok1,prof:n.Profession.Dau2,side:r.Side.Upward},null,{color:n.Color.Kok1,prof:n.Profession.Gua2,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Tuk2,side:r.Side.Upward}],[{color:n.Color.Kok1,prof:n.Profession.Kua2,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Maun1,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Kaun1,side:r.Side.Upward},{color:n.Color.Kok1,prof:n.Profession.Uai1,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Io,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Uai1,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Kaun1,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Maun1,side:r.Side.Upward},{color:n.Color.Huok2,prof:n.Profession.Kua2,side:r.Side.Upward}]],o.GAME_STATE=(e=>{let t=!0,n=20;const a=[[],[],[],[]];let l=0;return{last_move_focus:null,f:{currentBoard:e.IA_is_down?r.rotateBoard(r.rotateBoard(o.initial_board_with_IA_down)):r.rotateBoard(o.initial_board_with_IA_down),hop1zuo1OfDownward:[],hop1zuo1OfUpward:[]},IA_is_down:e.IA_is_down,tam_itself_is_tam_hue:!0,opponent_has_just_moved_tam:!1,set is_my_turn(e){t=!!e,t?(document.getElementById("larta_me").style.display="block",document.getElementById("larta_opponent").style.display="none",document.getElementById("opponent_message").innerHTML="",document.getElementById("protective_cover_over_field_while_waiting_for_opponent").classList.add("nocover")):(document.getElementById("larta_me").style.display="none",document.getElementById("larta_opponent").style.display="block",document.getElementById("protective_cover_over_field_while_waiting_for_opponent").classList.remove("nocover"),window.setTimeout(i.sendMainPoll,500*.8093))},get is_my_turn(){return t},backupDuringStepping:null,set my_score(e){a[l].push(e-n),n=e},get my_score(){return n},get season(){return l},set season(e){l=e},get scores_of_each_season(){return[a[0].concat([]),a[1].concat([]),a[2].concat([]),a[3].concat([])]},set scores_of_each_season(e){throw new Error("Cannot set scores_of_each_season. Please set my_score to reflect the change in the score.")},log2_rate:0}})({IA_is_down:(()=>{try{return JSON.parse(sessionStorage.is_IA_down_for_me)}catch(e){location.href="entrance.html"}})()})},495:(e,o)=>{function t(e){return 1+e*o.BOX_SIZE+(o.MAX_PIECE_SIZE-o.PIECE_SIZE)/2}Object.defineProperty(o,"__esModule",{value:!0}),o.indToHo1Zuo1OfDownward=o.indToHop1Zuo1Horizontal=o.coordToPieceXY_Shifted=o.coordToPieceXY=o.PIECE_SIZE=o.MAX_PIECE_SIZE=o.BOX_SIZE=void 0,o.BOX_SIZE=70,o.MAX_PIECE_SIZE=o.BOX_SIZE-1,o.PIECE_SIZE=60,o.coordToPieceXY=function(e){const[t,r]=e;return{top:1+t*o.BOX_SIZE+(o.MAX_PIECE_SIZE-o.PIECE_SIZE)/2,left:1+r*o.BOX_SIZE+(o.MAX_PIECE_SIZE-o.PIECE_SIZE)/2}},o.coordToPieceXY_Shifted=function(e){const[t,r]=e;return{top:1+t*o.BOX_SIZE+(o.MAX_PIECE_SIZE-o.PIECE_SIZE),left:1+r*o.BOX_SIZE}},o.indToHop1Zuo1Horizontal=t,o.indToHo1Zuo1OfDownward=function(e){return{top:-135,left:t(e)}}},204:(e,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.KIAR_ARK=void 0;const t={header:[],body:[]};o.KIAR_ARK=new Proxy(t,{set:function(e,o,r){return e[o]=r,console.log("_kiar_ark:",t),document.getElementById("kiar_ark").innerHTML=t.header.map((e=>e.dat)).join("\n")+"\n"+function(e){var o,t,r;let n="";for(let i=0;i<e.length;){const a=e[i],l=e[i+1];if("movement"===(null==a?void 0:a.type)&&"movement"===(null==l?void 0:l.type))n+=a.dat+(null!==(o=a.piece_capture_comment)&&void 0!==o?o:"")+"\t"+l.dat+(null!==(t=l.piece_capture_comment)&&void 0!==t?t:"")+"\n",i+=2;else if("tymoktaxot"===(null==a?void 0:a.type))n+="\n"+a.dat+"\n\n",i+=1;else{if("movement"!==(null==a?void 0:a.type)||"tymoktaxot"!==(null==l?void 0:l.type))throw new Error(`Unexpected: the types passed to KIAR_ARK.body are "${null==a?void 0:a.type}" followed by "${null==l?void 0:l.type}".`);n+=a.dat+(null!==(r=a.piece_capture_comment)&&void 0!==r?r:"")+"\n\n"+l.dat+"\n\n",i+=2}}return n}(t.body),!0}})},519:(e,o,t)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.drawField=o.endSeason=o.animatePunishStepTam=o.increaseRateAndAnimate=o.removeChildren=o.displayCiurl=o.animateWaterEntryLogo=o.animateStepTamLogo=o.calculateHandsAndScore=o.sendStuffTo=o.sendMainPoll=void 0;const r=t(728),n=t(513),i=t(849),a=t(892),l=t(460),s=t(974),d=t(892),c=t(462),u=t(495),f=t(935),p=t(392),_=t(798),m=t(431),w=t(204),{stopPolling:E,resumePolling:A,isPollingAllowed:y,allowPolling:T}=(()=>{let e=!0;return{stopPolling:()=>{e=!1},resumePolling:()=>{e=!0,window.setTimeout(h,500*.8093)},isPollingAllowed:()=>e,allowPolling:()=>{e=!0}}})();async function h(){var e;if(console.log("poll"),!y())return;const o=await D("mainpoll","`polling for the opponent's move`",{},(e=>(console.log("Success; the server returned:",JSON.stringify(e)),e)));if(!o.legal)throw alert(`sending MainPoll somehow resulted in an error: ${o.whyIllegal}`),new Error(`sending MainPoll somehow resulted in an error: ${o.whyIllegal}`);if("not yet"!==o.content){console.log("ding!"),document.getElementById("opponent_message").innerHTML=null!==(e=o.message)&&void 0!==e?e:"",new Audio("sound/thud.ogg").play();const t=o.content;if(console.log(t),"NonTamMove"===t.type)if(n.GAME_STATE.opponent_has_just_moved_tam=!1,"SrcDst"===t.data.type)await i.animateOpponentSrcDst(t.data),n.GAME_STATE.is_my_turn=!0,t.data.water_entry_ciurl?w.KIAR_ARK.body=[...w.KIAR_ARK.body,{type:"movement",dat:$(t,t.data.water_entry_ciurl.filter((e=>e)).length)}]:w.KIAR_ARK.body=[...w.KIAR_ARK.body,{type:"movement",dat:$(t)}];else if("FromHand"===t.data.type){const e={prof:t.data.prof,color:t.data.color,side:a.Side.Downward};await i.animateOpponentFromHand(e,n.fromAbsoluteCoord(t.data.dest)),n.GAME_STATE.is_my_turn=!0,w.KIAR_ARK.body=[...w.KIAR_ARK.body,{type:"movement",dat:$(t)}]}else{if("SrcStepDstFinite"!==t.data.type)throw t.data,new Error("does not happen");await i.animateOpponentSrcStepDstFinite(t.data),n.GAME_STATE.is_my_turn=!0,t.data.water_entry_ciurl?w.KIAR_ARK.body=[...w.KIAR_ARK.body,{type:"movement",dat:$(t,t.data.water_entry_ciurl.filter((e=>e)).length)}]:w.KIAR_ARK.body=[...w.KIAR_ARK.body,{type:"movement",dat:$(t)}]}else if("TamMove"===t.type)if(n.GAME_STATE.opponent_has_just_moved_tam=!0,"NoStep"===t.stepStyle)await i.animateOpponentTamNoStep(n.fromAbsoluteCoord(t.src),n.fromAbsoluteCoord(t.firstDest),n.fromAbsoluteCoord(t.secondDest)),n.GAME_STATE.is_my_turn=!0,w.KIAR_ARK.body=[...w.KIAR_ARK.body,{type:"movement",dat:$(t)}];else if("StepsDuringFormer"===t.stepStyle)await i.animateOpponentTamSteppingDuringFormer({src:n.fromAbsoluteCoord(t.src),firstDest:n.fromAbsoluteCoord(t.firstDest),secondDest:n.fromAbsoluteCoord(t.secondDest),step:n.fromAbsoluteCoord(t.step)}),n.GAME_STATE.is_my_turn=!0,w.KIAR_ARK.body=[...w.KIAR_ARK.body,{type:"movement",dat:$(t)}];else{if("StepsDuringLatter"!==t.stepStyle)throw t.stepStyle,new Error("does not happen");await i.animateOpponentTamSteppingDuringLatter({src:n.fromAbsoluteCoord(t.src),firstDest:n.fromAbsoluteCoord(t.firstDest),secondDest:n.fromAbsoluteCoord(t.secondDest),step:n.fromAbsoluteCoord(t.step)}),n.GAME_STATE.is_my_turn=!0,w.KIAR_ARK.body=[...w.KIAR_ARK.body,{type:"movement",dat:$(t)}]}else{if("InfAfterStep"!==t.type)throw new Error("does not happen");{n.GAME_STATE.opponent_has_just_moved_tam=!1;const e=null==t.finalResult?new Promise((async(e,o)=>{for(;;){const o=await D("infpoll","`polling for the opponent's afterhalfacceptance`",{},(e=>(console.log("Success; the server returned:",JSON.stringify(e)),e)));if(!1===o.legal)throw new Error("not good!!!");if("not yet"!==o.content){if("InfAfterStep"!==o.content.type)throw new Error("nooooooo");return void e(o.content.finalResult)}await new Promise((e=>setTimeout(e,500*.8093)))}})):Promise.resolve(t.finalResult),o=await i.animateOpponentInfAfterStep({src:n.fromAbsoluteCoord(t.src),step:n.fromAbsoluteCoord(t.step),plannedDirection:n.fromAbsoluteCoord(t.plannedDirection),stepping_ciurl:t.stepping_ciurl,finalResult:e});if(n.GAME_STATE.is_my_turn=!0,o.water_entry_ciurl){if(null==t.finalResult)throw new Error("This should not happen; it should have been rejected before the water entry");w.KIAR_ARK.body=[...w.KIAR_ARK.body,{type:"movement",dat:`${K(t.src)}片${K(t.step)}${K(o.dest)}橋${O(t.stepping_ciurl.filter((e=>e)).length)}水${O(o.water_entry_ciurl.filter((e=>e)).length)}此無`}]}else null!=t.finalResult?w.KIAR_ARK.body=[...w.KIAR_ARK.body,{type:"movement",dat:`${K(t.src)}片${K(t.step)}${K(o.dest)}橋${O(t.stepping_ciurl.filter((e=>e)).length)}`}]:w.KIAR_ARK.body=[...w.KIAR_ARK.body,{type:"movement",dat:`${K(t.src)}片${K(t.step)}${K(t.plannedDirection)}橋${O(t.stepping_ciurl.filter((e=>e)).length)}此無`}]}}}else await new Promise((e=>setTimeout(e,500*.8093))),await h()}o.sendMainPoll=h;let g={selectedCoord:null};function S(){Q(document.getElementById("contains_guides")),Q(document.getElementById("contains_guides_on_upward"))}function v(){const e=document.getElementById("contains_phantom");for(;e.firstChild;)e.removeChild(e.firstChild)}function I(){S(),v(),document.getElementById("protective_cover_over_field").classList.add("nocover");const e=n.GAME_STATE.backupDuringStepping,o=e[0];n.GAME_STATE.f.currentBoard[o[0]][o[1]]=e[1],n.GAME_STATE.backupDuringStepping=null,g.selectedCoord=null,console.log("drawField #",1),le({focus:n.GAME_STATE.last_move_focus})}function P(e,o,t){S(),document.getElementById("protective_tam_cover_over_field").classList.remove("nocover"),document.getElementById("protective_cover_over_field").classList.add("nocover"),n.GAME_STATE.f.currentBoard[e[0]][e[1]]=null,n.GAME_STATE.f.currentBoard[o[0]][o[1]]="Tam2",console.log("drawField #",4.1),le({focus:null}),C(e,"Tam2"),M((function(){S(),v(),document.getElementById("protective_tam_cover_over_field").classList.add("nocover"),document.getElementById("protective_cover_over_field").classList.add("nocover"),n.GAME_STATE.f.currentBoard[o[0]][o[1]]=null,n.GAME_STATE.f.currentBoard[e[0]][e[1]]="Tam2",g.selectedCoord=null,console.log("drawField #",5.1),le({focus:n.GAME_STATE.last_move_focus})})),function(o){const i=document.getElementById("contains_phantom"),a=r.createPieceSizeImageOnBoardByPath(o,l.toPath_("Tam2"),"piece_image_on_board");a.style.zIndex="100",a.style.cursor="pointer";const s=function(){const i=document.getElementById("contains_guides"),a=r.createPieceSizeImageOnBoardByPath(o,"selection2","selection");a.style.cursor="pointer",a.style.zIndex="200",i.appendChild(a);const{finite:l,infinite:s}=d.calculateMovablePositions(o,"Tam2",n.GAME_STATE.f.currentBoard,n.GAME_STATE.tam_itself_is_tam_hue);if(s.length>0)throw new Error("should not happen");for(let a=0;a<l.length;a++){const[s,c]=l[a],u=n.GAME_STATE.f.currentBoard[s][c];if(void 0!==t&&null!==u)continue;const f=r.createCircleGuideImageAt(l[a],"ctam");null===u?f.addEventListener("click",(function(){!function(e,o,r){console.assert(null==n.GAME_STATE.f.currentBoard[r[0]][r[1]]);const i=t?{type:"TamMove",stepStyle:"StepsDuringFormer",src:n.toAbsoluteCoord(e),step:n.toAbsoluteCoord(t),firstDest:n.toAbsoluteCoord(o),secondDest:n.toAbsoluteCoord(r)}:{type:"TamMove",stepStyle:"NoStep",src:n.toAbsoluteCoord(e),firstDest:n.toAbsoluteCoord(o),secondDest:n.toAbsoluteCoord(r)};v(),S(),R(i),document.getElementById("protective_tam_cover_over_field").classList.add("nocover")}(e,o,l[a])})):f.addEventListener("click",(function(){var t,i,s;t=e,i=o,s=l[a],S(),document.getElementById("protective_cover_over_field").classList.remove("nocover"),document.getElementById("protective_tam_cover_over_field").classList.remove("nocover"),n.GAME_STATE.backupDuringStepping=[i,"Tam2"],n.GAME_STATE.f.currentBoard[i[0]][i[1]]=null,document.getElementById("cancelButton").remove(),console.log("drawField #",2),le({focus:null}),C(i,"Tam2"),M((function(){S(),v(),document.getElementById("protective_cover_over_field").classList.add("nocover"),document.getElementById("protective_tam_cover_over_field").classList.add("nocover"),n.GAME_STATE.f.currentBoard[t[0]][t[1]]="Tam2",n.GAME_STATE.backupDuringStepping=null,g.selectedCoord=null,console.log("drawField #",3.1),le({focus:n.GAME_STATE.last_move_focus})})),B(s,"Tam2",(function(e,o){const a=document.getElementById("contains_guides"),l=r.createPieceSizeSelectionButtonOnBoard_Shifted(e);a.appendChild(l);const{finite:c,infinite:u}=d.calculateMovablePositions(e,o,n.GAME_STATE.f.currentBoard,n.GAME_STATE.tam_itself_is_tam_hue);if(u.length>0)throw new Error("should not happen");for(let e=0;e<c.length;e++){const o=c[e],[l,d]=o;if(null!==n.GAME_STATE.f.currentBoard[l][d])continue;const u=r.createCircleGuideImageAt(o,"ctam");u.addEventListener("click",(function(){const e={type:"TamMove",stepStyle:"StepsDuringLatter",src:n.toAbsoluteCoord(t),step:n.toAbsoluteCoord(s),firstDest:n.toAbsoluteCoord(i),secondDest:n.toAbsoluteCoord(o)};S(),v(),R(e),document.getElementById("protective_cover_over_field").classList.add("nocover"),document.getElementById("protective_tam_cover_over_field").classList.add("nocover")})),u.style.zIndex="200",a.appendChild(u)}}))})),f.style.zIndex="200",i.appendChild(f)}};a.addEventListener("click",s),i.appendChild(a),s()}(o)}function C(e,o){const t=document.getElementById("contains_phantom");v();const n=r.createPieceImgToBePlacedOnBoard(e,o);n.style.opacity="0.1",t.appendChild(n)}function M(e){const o=document.getElementById("contains_phantom"),t=r.createCancelButton();t.width=80,t.height=80,t.style.zIndex="100",t.style.cursor="pointer",t.setAttribute("id","cancelButton"),t.addEventListener("click",e),o.appendChild(t)}function B(e,o,t){const n=document.getElementById("contains_phantom"),i=r.createPieceSizeImageOnBoardByPath_Shifted(e,l.toPath_(o),"piece_image_on_board");i.style.zIndex="100",i.style.cursor="pointer";const a=function(){t(e,o)};i.addEventListener("click",a),n.appendChild(i),a()}function k(e,o,t){S(),document.getElementById("protective_cover_over_field").classList.remove("nocover"),n.GAME_STATE.backupDuringStepping=[e,o],n.GAME_STATE.f.currentBoard[e[0]][e[1]]=null,console.log("drawField #",6.1),le({focus:null}),C(e,o),M(I),B(t,o,(function(e,o){const t=document.getElementById("contains_guides"),i=r.createPieceSizeSelectionButtonOnBoard_Shifted(e);t.appendChild(i);const{finite:a,infinite:l}=d.calculateMovablePositions(e,o,n.GAME_STATE.f.currentBoard,n.GAME_STATE.tam_itself_is_tam_hue);if(q(e,{piece:o,path:"ct"},t,a),"Tam2"!==o)q(e,{piece:o,path:"ct2"},t,l);else if(l.length>0)throw new Error("should not happen")}))}async function b(e,o){const t=await G("`after half acceptance`",e,(e=>(console.log("Success; the server returned:",JSON.stringify(e)),e)));if(!t.legal)throw alert(`Illegal API sent, the reason being ${t.whyIllegal}`),new Error(`Illegal API sent, the reason being ${t.whyIllegal}`);if(!t.dat.waterEntryHappened)return S(),g.selectedCoord=null,L(e,o.src,o.step),console.log("drawField #",7),le({focus:n.GAME_STATE.last_move_focus}),n.GAME_STATE.is_my_turn=!1,void(e.dest?w.KIAR_ARK.body=[...w.KIAR_ARK.body,{type:"movement",dat:`${K(n.toAbsoluteCoord(o.src))}片${K(n.toAbsoluteCoord(o.step))}${K(e.dest)}橋${O(o.stepping_ciurl.filter((e=>e)).length)}`}]:w.KIAR_ARK.body=[...w.KIAR_ARK.body,{type:"movement",dat:`${K(n.toAbsoluteCoord(o.src))}片${K(n.toAbsoluteCoord(o.step))}${K(o.planned_destination)}橋${O(o.stepping_ciurl.filter((e=>e)).length)}此無`}]);if(await j(),Y(t.dat.ciurl),await new Promise((e=>setTimeout(e,500*.8093))),t.dat.ciurl.filter((e=>e)).length<3){if(alert(f.DICTIONARY.ja.failedWaterEntry),S(),g.selectedCoord=null,I(),n.GAME_STATE.is_my_turn=!1,!e.dest)throw new Error("This should not happen; it should have been rejected before the water entry");w.KIAR_ARK.body=[...w.KIAR_ARK.body,{type:"movement",dat:`${K(n.toAbsoluteCoord(o.src))}片${K(n.toAbsoluteCoord(o.step))}${K(e.dest)}橋${O(o.stepping_ciurl.filter((e=>e)).length)}水${O(t.dat.ciurl.filter((e=>e)).length)}此無`}]}else{if(S(),g.selectedCoord=null,L(e,o.src,o.step),console.log("drawField #",8),le({focus:n.GAME_STATE.last_move_focus}),n.GAME_STATE.is_my_turn=!1,!e.dest)throw new Error("This should not happen; it should have been rejected before the water entry");w.KIAR_ARK.body=[...w.KIAR_ARK.body,{type:"movement",dat:`${K(n.toAbsoluteCoord(o.src))}片${K(n.toAbsoluteCoord(o.step))}${K(e.dest)}橋${O(o.stepping_ciurl.filter((e=>e)).length)}水${O(t.dat.ciurl.filter((e=>e)).length)}`}]}}async function D(e,o,t,r){const n=document.getElementById("protective_cover_over_field_while_asyncawait");n.classList.remove("nocover"),console.log(`Sending ${o}:`,JSON.stringify(t));const i=`${p.API_ORIGIN}/${e}/`,a={message:t},l=await fetch(i,{method:"POST",body:JSON.stringify(a),headers:{"Content-Type":"application/json",Authorization:`Bearer ${sessionStorage.access_token}`}}).then((function(e){return n.classList.add("nocover"),e.json()})).then(r).catch((function(e){n.classList.add("nocover"),console.error("Error:",e)}));if(console.log(l),n.classList.add("nocover"),!l)throw alert("network error!"),n.classList.add("nocover"),new Error("network error!");return l}async function G(e,o,t){return await D("slow",e,o,t)}function K(e){return`${e[1]}${e[0]}`}function O(e){return["無","一","二","三","四","五"][e]}function $(e,o){if("NonTamMove"===e.type){if("FromHand"===e.data.type)return`${r=e.data.color,r===s.Color.Huok2?"黒":"赤"}${t=e.data.prof,["船","兵","弓","車","虎","馬","筆","巫","将","王"][t]}${K(e.data.dest)}`;if("SrcDst"===e.data.type)return void 0===o?`${K(e.data.src)}片${K(e.data.dest)}無撃裁`:o<3?`${K(e.data.src)}片${K(e.data.dest)}水${O(o)}此無`:`${K(e.data.src)}片${K(e.data.dest)}水${O(o)}`;if("SrcStepDstFinite"===e.data.type)return void 0===o?`${K(e.data.src)}片${K(e.data.step)}${K(e.data.dest)}無撃裁`:o<3?`${K(e.data.src)}片${K(e.data.step)}${K(e.data.dest)}水${O(o)}此無`:`${K(e.data.src)}片${K(e.data.step)}${K(e.data.dest)}水${O(o)}`;throw e.data,new Error("should not reach here")}if("TamMove"===e.type){if("NoStep"===e.stepStyle)return`${K(e.src)}皇[${K(e.firstDest)}]${K(e.secondDest)}`;if("StepsDuringFormer"===e.stepStyle)return`${K(e.src)}皇${K(e.step)}[${K(e.firstDest)}]${K(e.secondDest)}`;if("StepsDuringLatter"===e.stepStyle)return`${K(e.src)}皇[${K(e.firstDest)}]${K(e.step)}${K(e.secondDest)}`;throw e.stepStyle,new Error("should not reach here")}throw new Error("should not reach here");var t,r}async function R(e){const o=await G("normal move",e,(e=>(console.log("Success; the server returned:",JSON.stringify(e)),e)));if(!o.legal)throw alert(`Illegal API sent, the reason being ${o.whyIllegal}`),new Error(`Illegal API sent, the reason being ${o.whyIllegal}`);if(!o.dat.waterEntryHappened)return S(),g.selectedCoord=null,N(e),console.log("drawField #",9),le({focus:n.GAME_STATE.last_move_focus}),n.GAME_STATE.is_my_turn=!1,void(w.KIAR_ARK.body=[...w.KIAR_ARK.body,{type:"movement",dat:$(e)}]);await j(),Y(o.dat.ciurl),await new Promise((e=>setTimeout(e,500*.8093))),o.dat.ciurl.filter((e=>e)).length<3?(alert(f.DICTIONARY.ja.failedWaterEntry),S(),g.selectedCoord=null,"NonTamMove"===e.type&&"SrcStepDstFinite"===e.data.type&&I(),n.GAME_STATE.is_my_turn=!1):(S(),g.selectedCoord=null,N(e),console.log("drawField #",10),le({focus:n.GAME_STATE.last_move_focus}),n.GAME_STATE.is_my_turn=!1),w.KIAR_ARK.body=[...w.KIAR_ARK.body,{type:"movement",dat:$(e,o.dat.ciurl.filter((e=>e)).length)}]}function L(e,o,t){if(console.log(o,t),null===e.dest)return I(),console.log("lone assignment to last_move_focus, #",0),void(n.GAME_STATE.last_move_focus=o);const[r,i]=n.fromAbsoluteCoord(e.dest),l=n.GAME_STATE.backupDuringStepping[1];I();const[s,d]=o,[c,u]=t;if(null===n.GAME_STATE.f.currentBoard[c][u])throw new Error("step is unoccupied");const f=n.GAME_STATE.f.currentBoard[r][i];if(a.coordEq([s,d],[r,i]))return console.log("lone assignment to last_move_focus, #",1),void(n.GAME_STATE.last_move_focus=[s,d]);null!==f&&H(f),n.GAME_STATE.f.currentBoard[s][d]=null,n.GAME_STATE.f.currentBoard[r][i]=l,console.log("lone assignment to last_move_focus, #",2),n.GAME_STATE.last_move_focus=[r,i]}function H(e){const o=(()=>{if("Tam2"===e)throw new Error("dest is occupied by Tam2");if(e.side===a.Side.Upward)throw new Error("dest is occupied by an ally");if(e.side===a.Side.Downward)return{color:e.color,prof:e.prof,side:a.Side.Upward};throw e.side,new Error("should not reach here")})(),t=U(n.GAME_STATE.f.hop1zuo1OfUpward);n.GAME_STATE.f.hop1zuo1OfUpward.push(o);const i=U(n.GAME_STATE.f.hop1zuo1OfUpward);i.score!==t.score&&(setTimeout((()=>{_.drawScoreDisplay(i.hands),function(e){const o=e.score,t=document.getElementById("score_display"),i=r.createImageButton("dat2/再行",0);i.addEventListener("click",(async()=>{if(V(!0),!0!==(await D("whethertymok","`send whether ty mok1`",!0,(e=>(console.log("Success; the server returned:",JSON.stringify(e)),e)))).legal)throw new Error("bad!!!!");w.KIAR_ARK.body=[...w.KIAR_ARK.body,{type:"tymoktaxot",dat:`或為${e.hands.join("加")}\n再行`}]})),t.appendChild(i);const a=r.createImageButton("dat2/終季",250);a.addEventListener("click",(async()=>{const t=await D("whethertymok","`send whether ty mok1`",!1,(e=>(console.log("Success; the server returned:",JSON.stringify(e)),e)));if(!0!==t.legal)throw new Error("bad!!!!");const r=t.is_first_move_my_move;te(o,r),w.KIAR_ARK.body=[...w.KIAR_ARK.body,{type:"tymoktaxot",dat:`或為${e.hands.join("加")}而手${o*Math.pow(2,n.GAME_STATE.log2_rate)}\n終季`}]})),t.appendChild(a)}(i)}),1e3*.8093),E())}function U(e){const o=e.map((e=>{return o=e.color,t=e.prof,[["赤船","赤兵","赤弓","赤車","赤虎","赤馬","赤筆","赤巫","赤将","赤王"],["黒船","黒兵","黒弓","黒車","黒虎","黒馬","黒筆","黒巫","黒将","黒王"]][o][t];var o,t})),t=m.calculate_hands_and_score_from_pieces(o);if(!0===t.error)throw new Error(`should not happen: too many of ${t.too_many.join(",")}`);return{hands:t.hands,score:t.score}}function N(e){if("NonTamMove"===e.type)if("FromHand"===e.data.type){const o=e.data,t=n.GAME_STATE.f.hop1zuo1OfUpward.findIndex((e=>e.color===o.color&&e.prof===o.prof));if(-1===t)throw new Error("What should exist in the hand does not exist");const[r]=n.GAME_STATE.f.hop1zuo1OfUpward.splice(t,1),[i,a]=n.fromAbsoluteCoord(o.dest);if(null!==n.GAME_STATE.f.currentBoard[i][a])throw new Error("Trying to parachute the piece onto an occupied space");n.GAME_STATE.f.currentBoard[i][a]=r,console.log("lone assignment to last_move_focus, #",3),n.GAME_STATE.last_move_focus=[i,a]}else if("SrcDst"===e.data.type){const o=e.data,[t,r]=n.fromAbsoluteCoord(o.src),[i,a]=n.fromAbsoluteCoord(o.dest),l=n.GAME_STATE.f.currentBoard[t][r];if(null===l)throw new Error("src is unoccupied");const s=n.GAME_STATE.f.currentBoard[i][a];null!==s&&H(s),n.GAME_STATE.f.currentBoard[t][r]=null,n.GAME_STATE.f.currentBoard[i][a]=l,console.log("lone assignment to last_move_focus, #",4),n.GAME_STATE.last_move_focus=[i,a]}else if("SrcStepDstFinite"===e.data.type){const o=e.data,[t,r]=n.fromAbsoluteCoord(o.src),[i,l]=n.fromAbsoluteCoord(o.dest),s=n.GAME_STATE.backupDuringStepping[1];I();const[d,c]=n.fromAbsoluteCoord(o.step);if(null===n.GAME_STATE.f.currentBoard[d][c])throw new Error("step is unoccupied");const u=n.GAME_STATE.f.currentBoard[i][l];if(a.coordEq([t,r],[i,l]))return;null!==u&&H(u),n.GAME_STATE.f.currentBoard[t][r]=null,n.GAME_STATE.f.currentBoard[i][l]=s,n.GAME_STATE.last_move_focus=[i,l],console.log("lone assignment to last_move_focus, #",5)}else e.data;else if("TamMove"===e.type){const o=e,[t,r]=n.fromAbsoluteCoord(o.firstDest),[i,l]=n.fromAbsoluteCoord(o.secondDest);if("StepsDuringLatter"===e.stepStyle)return n.GAME_STATE.f.currentBoard[i][l]="Tam2",n.GAME_STATE.last_move_focus=[i,l],void console.log("lone assignment to last_move_focus, #",6);const s=n.GAME_STATE.f.currentBoard[t][r];if(null===s)throw new Error("firstDest is unoccupied");if("Tam2"!==s)throw new Error("TamMove but not Tam2");if(a.coordEq([t,r],[i,l]))return n.GAME_STATE.last_move_focus=[i,l],void console.log("lone assignment to last_move_focus, #",7);n.GAME_STATE.f.currentBoard[t][r]=null,n.GAME_STATE.f.currentBoard[i][l]=s,n.GAME_STATE.last_move_focus=[i,l],console.log("lone assignment to last_move_focus, #",8)}}function F(e,o,t,r){if(null!=n.GAME_STATE.f.currentBoard[t[0]][t[1]])d.canGetOccupiedBy(a.Side.Upward,t,e,n.GAME_STATE.f.currentBoard,n.GAME_STATE.tam_itself_is_tam_hue)&&r&&confirm(f.DICTIONARY.ja.whetherToTake)?R({type:"NonTamMove",data:{type:"SrcDst",src:n.toAbsoluteCoord(o),dest:n.toAbsoluteCoord(t)}}):k(o,e,t);else{let r;if("Tam2"!==e)return r={type:"NonTamMove",data:{type:"SrcDst",src:n.toAbsoluteCoord(o),dest:n.toAbsoluteCoord(t)}},void R(r);P(o,t)}}function X(e){const[o,t]=e;return"Tam2"===n.GAME_STATE.f.currentBoard[o][t]}function x(e,o,t,r){if("Tam2"===t)return void P(e,r,o);const i={type:"NonTamMove",data:{type:"SrcStepDstFinite",step:n.toAbsoluteCoord(o),dest:n.toAbsoluteCoord(r),src:n.toAbsoluteCoord(e)}};X(o)?(async()=>{await Z(),await oe(a.Side.Upward),await R(i)})():R(i)}async function z(e,o){const t=await G("inf after step",e,(e=>(console.log("Success; the server returned:",JSON.stringify(e)),e)));if(!t.legal)throw alert(`Illegal API sent, the reason being ${t.whyIllegal}`),new Error(`Illegal API sent, the reason being ${t.whyIllegal}`);X(n.fromAbsoluteCoord(e.step))&&(await Z(),await oe(a.Side.Upward)),Y(t.ciurl),document.getElementById("cancelButton").remove(),S();const i=n.fromAbsoluteCoord(e.step),l=n.fromAbsoluteCoord(e.plannedDirection),s=r.createPieceSizeImageOnBoardByPath_Shifted(i,"selection2","selection");s.style.zIndex="200";const u=document.getElementById("contains_guides");u.appendChild(s);const f={color:o.color,prof:o.prof,side:a.Side.Upward},{infinite:p}=d.calculateMovablePositions(i,f,n.GAME_STATE.f.currentBoard,n.GAME_STATE.tam_itself_is_tam_hue),_=c.filterInOneDirectionTillCiurlLimit(p,i,l,t.ciurl),m=n.fromAbsoluteCoord(e.src),w=r.createCircleGuideImageAt(m,"ct");w.addEventListener("click",(function(o){S(),b({type:"AfterHalfAcceptance",dest:null},{src:m,step:i,stepping_ciurl:t.ciurl,planned_destination:e.plannedDirection})})),w.style.zIndex="200",u.appendChild(w);for(let o=0;o<_.length;o++){const l=_[o];if(a.coordEq(m,l))continue;if(!d.canGetOccupiedByNonTam(a.Side.Upward,l,n.GAME_STATE.f.currentBoard,n.GAME_STATE.tam_itself_is_tam_hue))continue;const s=r.createCircleGuideImageAt(_[o],"ct2");s.addEventListener("click",(function(o){b({type:"AfterHalfAcceptance",dest:n.toAbsoluteCoord(l)},{src:m,step:i,stepping_ciurl:t.ciurl,planned_destination:e.plannedDirection})})),s.style.zIndex="200",u.appendChild(s)}}async function Z(){const e=document.getElementById("step_tam_logo");e.style.display="block",e.classList.add("step_tam");const o=document.getElementById("protective_cover_over_field_while_asyncawait");o.classList.remove("nocover"),setTimeout((function(){e.style.display="none",o.classList.add("nocover")}),971.16),await new Promise((e=>setTimeout(e,1e3*.8093)))}async function j(){const e=document.getElementById("water_entry_logo");e.style.display="block",e.classList.add("water_entry");const o=document.getElementById("protective_cover_over_field_while_asyncawait");o.classList.remove("nocover"),setTimeout((function(){e.style.display="none",o.classList.add("nocover")}),971.16),await new Promise((e=>setTimeout(e,1e3*.8093)))}function Y(e,o){const t=function(){let e=0,o=0;for(;0===e;)e=Math.random();for(;0===o;)o=Math.random();return Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*o)},n=document.getElementById("contains_ciurl");Q(document.getElementById("contains_ciurl"));const i=u.BOX_SIZE*(335/70+t()/6),l=84+(null==o||o===a.Side.Upward?771:0),s=e.map(((o,n)=>r.createCiurl(o,{left:i+.2*u.BOX_SIZE*t(),top:l+26*(n+.5-e.length/2)+.05*u.BOX_SIZE*t(),rotateDeg:40*Math.random()-20})));for(let e=s.length-1;e>0;e--){const o=Math.floor(Math.random()*(e+1));[s[e],s[o]]=[s[o],s[e]]}for(let e=0;e<s.length;e++)n.appendChild(s[e]);new Audio("sound/ciurl4.ogg").play()}function q(e,o,t,i){const l=g.selectedCoord;if(null==l)throw new Error("though stepping, null startpoint!!!!!");if("Hop1zuo1"===l[0])throw new Error("though stepping, hop1zuo1 startpoint!!!!!");for(let s=0;s<i.length;s++){if(!d.canGetOccupiedBy(a.Side.Upward,i[s],o.piece,n.GAME_STATE.f.currentBoard,n.GAME_STATE.tam_itself_is_tam_hue))continue;const c=r.createCircleGuideImageAt(i[s],o.path);c.addEventListener("click","ct"===o.path?function(){S(),x(l,e,o.piece,i[s])}:function(){S(),z({type:"InfAfterStep",step:n.toAbsoluteCoord(e),plannedDirection:n.toAbsoluteCoord(i[s]),src:n.toAbsoluteCoord(l)},{color:o.piece.color,prof:o.piece.prof})}),c.style.zIndex="200",t.appendChild(c)}}function W(e,o){if(S(),null!=g.selectedCoord&&"Hop1zuo1"!==g.selectedCoord[0]&&a.coordEq(g.selectedCoord,e))g.selectedCoord=null;else{g.selectedCoord=e;const t=document.getElementById("contains_guides"),i=r.createPieceSizeImageOnBoardByPath(e,"selection2","selection");i.style.cursor="pointer",i.addEventListener("click",(function(){S(),g.selectedCoord=null})),t.appendChild(i);const{finite:a,infinite:l}=d.calculateMovablePositions(e,o,n.GAME_STATE.f.currentBoard,n.GAME_STATE.tam_itself_is_tam_hue);!function(e,o,t,n){for(let i=0;i<n.length;i++){const a=r.createCircleGuideImageAt(n[i],"ct");a.addEventListener("click",(function(){S(),F(o,e,n[i],!0)})),a.addEventListener("contextmenu",(function(t){S(),t.preventDefault(),F(o,e,n[i],!1)})),t.appendChild(a)}}(e,o,t,[...a,...l])}}function J(e,o){if(S(),null==g.selectedCoord||"Hop1zuo1"!==g.selectedCoord[0]||g.selectedCoord[1]!==e){g.selectedCoord=["Hop1zuo1",e];const t=document.getElementById("contains_guides_on_upward"),i=r.createPieceSizeImageOnBoardByPathAndXY(1+(u.MAX_PIECE_SIZE-u.PIECE_SIZE)/2,u.indToHop1Zuo1Horizontal(e),"selection2","selection");i.style.cursor="pointer",i.addEventListener("click",(function(){S(),g.selectedCoord=null})),t.appendChild(i);const a=document.getElementById("contains_guides");for(let e=0;e<9;e++)for(let t=0;t<9;t++){const i=[e,t];if(null!=n.GAME_STATE.f.currentBoard[e][t])continue;const l=r.createCircleGuideImageAt(i,"ct");l.addEventListener("click",(function(){S(),function(e,o){if(null!=n.GAME_STATE.f.currentBoard[o[0]][o[1]])throw alert("Cannot parachute onto an occupied square"),new Error("Cannot parachute onto an occupied square");const t=n.toAbsoluteCoord(o);R({type:"NonTamMove",data:{type:"FromHand",color:e.color,prof:e.prof,dest:t}})}(o,i)})),a.appendChild(l)}}else g.selectedCoord=null}function Q(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function V(e){document.getElementById("score_display").classList.add("nocover");const o=n.GAME_STATE.log2_rate;ae(),n.GAME_STATE.log2_rate={0:1,1:2,2:3,3:4,4:5,5:6,6:6}[o];const t=document.getElementById("denote_rate");setTimeout((async()=>{t.style.display="block",await new Promise((e=>setTimeout(e,161.86))),await i.animateNode(t,1e3*.8093,ie(n.GAME_STATE.log2_rate),ie(o)),await new Promise((e=>setTimeout(e,500*.8093))),ae(),e?A():n.GAME_STATE.is_my_turn=!0,document.getElementById("protective_cover_over_field_while_asyncawait").classList.add("nocover")}),161.86)}function ee(e,o){_.drawFinalScoreDisplay(function(e,o){const t=e=>[e.slice(0,-1).reduce(((e,o)=>e+o),0),e[e.length-1]],r=e?e=>[e.reduce(((e,o)=>e+o),0)]:t;if(0===o[0].length)throw new Error("why did the game end without any movement of points?");return 0===o[1].length?[r(o[0])]:0===o[2].length?[t(o[0]),r(o[1])]:0===o[3].length?[t(o[0]),t(o[1]),r(o[2])]:[t(o[0]),t(o[1]),t(o[2]),r(o[3])]}(o,n.GAME_STATE.scores_of_each_season)),document.getElementById("larta_me").style.display="block",document.getElementById("larta_opponent").style.display="block",document.getElementById("opponent_message").innerHTML="you win!"===e?"あなたの勝ちです":"draw"===e?"引き分けです":"あなたの負けです"}async function oe(e){var o,t,r,l,s;document.getElementById("score_display").classList.add("nocover");const d=document.getElementById("denote_score"),c=n.GAME_STATE.my_score;return n.GAME_STATE.my_score+=(e===a.Side.Upward?-5:5)*Math.pow(2,n.GAME_STATE.log2_rate),await new Promise((e=>setTimeout(e,161.86))),await i.animateNode(d,1e3*.8093,ne(n.GAME_STATE.my_score),ne(c)),n.GAME_STATE.my_score>=40?(ee("you win!",!0),void(null===(o=document.getElementById("protective_cover_over_field_while_waiting_for_opponent"))||void 0===o||o.classList.remove("nocover"))):n.GAME_STATE.my_score<=0?(ee("you lose...",!0),void(null===(t=document.getElementById("protective_cover_over_field_while_waiting_for_opponent"))||void 0===t||t.classList.remove("nocover"))):(await new Promise((e=>setTimeout(e,242.79))),ae(),await new Promise((e=>setTimeout(e,242.79))),null===(r=document.getElementById("protective_cover_over_field"))||void 0===r||r.classList.add("nocover"),null===(l=document.getElementById("protective_tam_cover_over_field"))||void 0===l||l.classList.add("nocover"),void(null===(s=document.getElementById("protective_cover_over_field_while_asyncawait"))||void 0===s||s.classList.add("nocover")))}function te(e,o){document.getElementById("score_display").classList.add("nocover");const t=document.getElementById("denote_season"),r=document.getElementById("denote_score"),l=n.GAME_STATE.my_score,s=n.GAME_STATE.season;n.GAME_STATE.my_score+=e*Math.pow(2,n.GAME_STATE.log2_rate);const d={0:1,1:2,2:3,3:null}[s];null!=d?(n.GAME_STATE.season=d,setTimeout((async()=>{var e,d,c,u,p;await i.animateNode(r,1e3*.8093,ne(n.GAME_STATE.my_score),ne(l)),n.GAME_STATE.my_score>=40?ee("you win!",!1):n.GAME_STATE.my_score<=0?ee("you lose...",!1):(await i.animateNode(t,566.51,re(n.GAME_STATE.season),re(s)),await new Promise((e=>setTimeout(e,242.79))),ae(),alert(f.DICTIONARY.ja.newSeason[n.GAME_STATE.season]),await new Promise((e=>setTimeout(e,242.79))),null===(e=document.getElementById("protective_cover_over_field"))||void 0===e||e.classList.remove("nocover"),null===(d=document.getElementById("protective_tam_cover_over_field"))||void 0===d||d.classList.remove("nocover"),await new Promise((e=>setTimeout(e,4e3*.8093))),n.GAME_STATE.f={currentBoard:n.GAME_STATE.IA_is_down?a.rotateBoard(a.rotateBoard(n.initial_board_with_IA_down)):a.rotateBoard(n.initial_board_with_IA_down),hop1zuo1OfDownward:[],hop1zuo1OfUpward:[]},n.GAME_STATE.log2_rate=0,T(),n.GAME_STATE.last_move_focus=null,console.log("drawField #",11),le({focus:null}),await new Promise((e=>setTimeout(e,242.79))),null===(c=document.getElementById("protective_cover_over_field"))||void 0===c||c.classList.add("nocover"),null===(u=document.getElementById("protective_tam_cover_over_field"))||void 0===u||u.classList.add("nocover"),n.GAME_STATE.is_my_turn=o,null===(p=document.getElementById("protective_cover_over_field_while_asyncawait"))||void 0===p||p.classList.add("nocover"))}),161.86)):setTimeout((async()=>(await i.animateNode(r,1e3*.8093,ne(n.GAME_STATE.my_score),ne(l)),alert(f.DICTIONARY.ja.gameEnd),n.GAME_STATE.my_score>20?void ee("you win!",!1):n.GAME_STATE.my_score<20?void ee("you lose...",!1):void ee("draw",!1))),161.86)}function re(e){return{top:360+51*(3-e),left:3}}function ne(e){return{top:447+21.83333333333333*(20-e),left:65}}function ie(e){return{top:873-96.66666666666667*(e-1),left:4}}function ae(){const e=document.getElementById("denote_season");e.style.top=`${re(n.GAME_STATE.season).top}px`,e.style.transition="",e.style.transform="";const o=document.getElementById("denote_score");o.style.top=`${ne(n.GAME_STATE.my_score).top}px`,o.style.transition="",o.style.transform="";const t=document.getElementById("denote_rate");0===n.GAME_STATE.log2_rate?t.style.display="none":t.style.display="block",t.style.top=`${ie(n.GAME_STATE.log2_rate).top}px`,t.style.transition="",t.style.transform=""}function le(e){console.log("focusing:",e.focus),function(o){const t=document.getElementById("contains_pieces_on_board");Q(t);for(let i=0;i<o.length;i++)for(let l=0;l<o[i].length;l++){const s=o[i][l];if(null==s)continue;const d=[i,l],c=r.createPieceImgToBePlacedOnBoard(d,s);if(c.id=`field_piece_${i}_${l}`,e.focus&&d[0]===e.focus[0]&&d[1]===e.focus[1]&&(c.style.border="8px solid #ff6",c.style.margin="-8px"),"Tam2"===s)n.GAME_STATE.opponent_has_just_moved_tam||(c.style.cursor="pointer",c.addEventListener("click",(function(){W(d,s)})));else if(s.side===a.Side.Upward){const e={prof:s.prof,side:a.Side.Upward,color:s.color};c.style.cursor="pointer",c.addEventListener("click",(function(){W(d,e)}))}t.appendChild(c)}}(n.GAME_STATE.f.currentBoard),function(e){const o=document.getElementById("contains_pieces_on_upward");Q(o);for(let t=0;t<e.length;t++){const n=e[t],i=r.createPieceImgToBePlacedOnHop1zuo1(t,l.toPath(n));i.style.cursor="pointer",i.addEventListener("click",(function(){J(t,n)})),o.appendChild(i)}}(n.GAME_STATE.f.hop1zuo1OfUpward),function(e){const o=document.getElementById("contains_pieces_on_downward");Q(o);for(let t=0;t<e.length;t++){const n=e[t],i=r.createPieceImgToBePlacedOnHop1zuo1(t,l.toPath(n));i.id=`hop1zuo1OfDownward_${t}`,o.appendChild(i)}}(n.GAME_STATE.f.hop1zuo1OfDownward)}o.sendStuffTo=D,o.calculateHandsAndScore=U,o.animateStepTamLogo=Z,o.animateWaterEntryLogo=j,o.displayCiurl=Y,o.removeChildren=Q,o.increaseRateAndAnimate=V,o.animatePunishStepTam=oe,o.endSeason=te,o.drawField=le},849:(e,o,t)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.animateOpponentTamSteppingDuringLatter=o.animateOpponentTamSteppingDuringFormer=o.animateOpponentTamNoStep=o.animateOpponentFromHand=o.animateOpponentSrcDst=o.animateOpponentInfAfterStep=o.animateOpponentSrcStepDstFinite=o.animateNode=void 0;const r=t(892),n=t(513),i=t(495),a=t(728),l=t(519),s=t(935),d=t(798);async function c(e,o,t,r,n="100",i){e.style.transition=`transform ${o/1e3}s ease`,e.style.zIndex=n,e.style.transform=`translateY(${t.top-r.top}px)`,e.style.transform+=`translateX(${t.left-r.left}px)`,null!=i&&(e.style.transform+=`rotate(${i}deg)`),await new Promise((e=>setTimeout(e,o)))}function u(e){const o=(()=>{if("Tam2"===e)throw new Error("tried to convert Tam2 into downward");if(e.side===r.Side.Downward)throw new Error("tried to convert an already downward piece to downward");if(e.side===r.Side.Upward)return{color:e.color,prof:e.prof,side:r.Side.Downward};throw e.side,new Error("should not reach here")})(),t=l.calculateHandsAndScore(n.GAME_STATE.f.hop1zuo1OfDownward);n.GAME_STATE.f.hop1zuo1OfDownward.push(o);const i=l.calculateHandsAndScore(n.GAME_STATE.f.hop1zuo1OfDownward);i.score!==t.score&&(document.getElementById("protective_cover_over_field_while_waiting_for_opponent").classList.remove("nocover"),document.getElementById("protective_cover_over_field_while_asyncawait").classList.remove("nocover"),window.setTimeout((async()=>{await f(i.score)}),0),window.setTimeout((()=>{d.drawScoreDisplay(i.hands)}),1e3*.8093))}async function f(e){console.log("poll whether ty mok1 or ta xot1");const o=await l.sendStuffTo("whethertymokpoll","`polling for whether the declaration is ty mok1 or ta xot1`",{},(e=>(console.log("Success; the server returned:",JSON.stringify(e)),e)));if(!o.legal)throw alert(`sending TyMok1OrTaXot1Poll somehow resulted in an error: ${o.whyIllegal}`),new Error(`sending TyMok1OrTaXot1Poll somehow resulted in an error: ${o.whyIllegal}`);if("not yet"!==o.content){console.log("ding!");const t=document.getElementById("score_display");for(await new Promise((e=>setTimeout(e,242.79)));!t.hasChildNodes();)await new Promise((e=>setTimeout(e,80.93)));"ty mok1"===o.content?(t.innerHTML+='<img src="image/dat2/再行.png" style="position: absolute; left: 660px; top: 125px; " height="200">',await new Promise((e=>setTimeout(e,2e3*.8093))),console.log("go on with ty mok1"),l.increaseRateAndAnimate(!1)):(t.innerHTML+='<img src="image/dat2/終季.png" style="position: absolute; left: 660px; top: 125px; " height="200">',await new Promise((e=>setTimeout(e,2e3*.8093))),console.log("go on with ta xot1"),l.endSeason(-e,o.content.is_first_move_my_move))}else document.getElementById("protective_cover_over_field_while_waiting_for_opponent").classList.remove("nocover"),await new Promise((e=>setTimeout(e,500*.8093))),await f(e)}async function p(e,o,t,a){const[d,f]=e,[p,_]=o,[m,w]=t,E=n.GAME_STATE.f.currentBoard[d][f];if(null===E)throw new Error("src is unoccupied");const A=n.GAME_STATE.f.currentBoard[p][_];if(null===A)throw new Error("step is unoccupied");"Tam2"===A&&(await l.animateStepTamLogo(),await l.animatePunishStepTam(r.Side.Downward));const y=n.GAME_STATE.f.currentBoard[m][w];if(null===y||r.coordEq(e,t)){const u=document.getElementById(`field_piece_${d}_${f}`);if(await c(u,606.975,i.coordToPieceXY_Shifted(o),i.coordToPieceXY(e)),await new Promise((e=>setTimeout(e,242.79))),await c(u,606.975,i.coordToPieceXY(t),i.coordToPieceXY(e)),a&&(await l.animateWaterEntryLogo(),l.displayCiurl(a,r.Side.Downward),await new Promise((e=>setTimeout(e,500*.8093))),a.filter((e=>e)).length<3))return alert(s.DICTIONARY.ja.failedWaterEntry),console.log("drawField opponent #",18),n.GAME_STATE.last_move_focus=[d,f],void l.drawField({focus:[d,f]});r.coordEq(e,t)||(n.GAME_STATE.f.currentBoard[d][f]=null,n.GAME_STATE.f.currentBoard[m][w]=E),console.log("drawField opponent #",19),n.GAME_STATE.last_move_focus=[m,w],l.drawField({focus:[m,w]})}else{const p=document.getElementById(`field_piece_${d}_${f}`),_=document.getElementById(`field_piece_${m}_${w}`);if(await c(p,606.975,i.coordToPieceXY_Shifted(o),i.coordToPieceXY(e)),await new Promise((e=>setTimeout(e,242.79))),await c(p,606.975,i.coordToPieceXY(t),i.coordToPieceXY(e)),await new Promise((e=>setTimeout(e,242.79))),await c(_,606.975,i.indToHo1Zuo1OfDownward(n.GAME_STATE.f.hop1zuo1OfDownward.length),i.coordToPieceXY([m,w]),"50",180),a&&(await l.animateWaterEntryLogo(),l.displayCiurl(a,r.Side.Downward),await new Promise((e=>setTimeout(e,500*.8093))),a.filter((e=>e)).length<3))return alert(s.DICTIONARY.ja.failedWaterEntry),console.log("drawField opponent #",16),n.GAME_STATE.last_move_focus=[d,f],void l.drawField({focus:[d,f]});r.coordEq(e,t)||(u(y),n.GAME_STATE.f.currentBoard[d][f]=null,n.GAME_STATE.f.currentBoard[m][w]=E),console.log("drawField opponent #",17),n.GAME_STATE.last_move_focus=[m,w],l.drawField({focus:[m,w]})}}async function _(e,o,t){const[a,d]=e,[f,p]=o,_=n.GAME_STATE.f.currentBoard[a][d];if(null===_)throw new Error("src is unoccupied");const m=n.GAME_STATE.f.currentBoard[f][p];if(null!==m){const e=document.getElementById(`field_piece_${a}_${d}`),o=document.getElementById(`field_piece_${f}_${p}`),w=606.975;if(await c(e,w,i.coordToPieceXY([f,p]),i.coordToPieceXY([a,d])),await c(o,w,i.indToHo1Zuo1OfDownward(n.GAME_STATE.f.hop1zuo1OfDownward.length),i.coordToPieceXY([f,p]),"50",180),t.water_entry_ciurl&&(await l.animateWaterEntryLogo(),l.displayCiurl(t.water_entry_ciurl,r.Side.Downward),await new Promise((e=>setTimeout(e,500*.8093))),t.water_entry_ciurl.filter((e=>e)).length<3))return alert(s.DICTIONARY.ja.failedWaterEntry),console.log("drawField opponent #",20),n.GAME_STATE.last_move_focus=[a,d],void l.drawField({focus:[a,d]});u(m),n.GAME_STATE.f.currentBoard[a][d]=null,n.GAME_STATE.f.currentBoard[f][p]=_,console.log("drawField opponent #",21),n.GAME_STATE.last_move_focus=[f,p],l.drawField({focus:[f,p]})}else{const e=document.getElementById(`field_piece_${a}_${d}`);if(await c(e,1213.95,i.coordToPieceXY([f,p]),i.coordToPieceXY([a,d])),t.water_entry_ciurl&&(await l.animateWaterEntryLogo(),l.displayCiurl(t.water_entry_ciurl,r.Side.Downward),await new Promise((e=>setTimeout(e,500*.8093))),t.water_entry_ciurl.filter((e=>e)).length<3))return alert(s.DICTIONARY.ja.failedWaterEntry),console.log("drawField opponent #",22),n.GAME_STATE.last_move_focus=[a,d],void l.drawField({focus:[a,d]});n.GAME_STATE.f.currentBoard[a][d]=null,n.GAME_STATE.f.currentBoard[f][p]=_,t.disable_focus?l.drawField({focus:null}):(console.log("drawField opponent #",23),n.GAME_STATE.last_move_focus=[f,p],l.drawField({focus:[f,p]}))}}o.animateNode=c,o.animateOpponentSrcStepDstFinite=async function(e){await p(n.fromAbsoluteCoord(e.src),n.fromAbsoluteCoord(e.step),n.fromAbsoluteCoord(e.dest),e.water_entry_ciurl)},o.animateOpponentInfAfterStep=async function(e){const[o,t]=e.src,[d,f]=e.step,p=n.GAME_STATE.f.currentBoard[o][t];if(null===p)throw new Error("src is unoccupied");const _=n.GAME_STATE.f.currentBoard[d][f];if(null===_)throw new Error("step is unoccupied");"Tam2"===_&&(await l.animateStepTamLogo(),await l.animatePunishStepTam(r.Side.Downward));const m=document.getElementById(`field_piece_${o}_${t}`);await c(m,606.975,i.coordToPieceXY_Shifted(e.step),i.coordToPieceXY(e.src)),await new Promise((e=>setTimeout(e,242.79))),await async function(e,o,t){!function(e,o){if(e[1]===o[1]&&e[0]>o[0]){document.getElementById("arrows").appendChild(a.createArrowPiece("arrow/arrow_up_head",o));for(let t=o[0];t<=e[0]-1;t++)document.getElementById("arrows").appendChild(a.createArrowPiece("arrow/arrow_up_mid",[t,e[1]]));document.getElementById("arrows").appendChild(a.createArrowPiece("arrow/arrow_up_tail",[e[0]-1,e[1]]))}else if(e[1]===o[1]&&e[0]<o[0]){document.getElementById("arrows").appendChild(a.createArrowPiece("arrow/arrow_down_tail",e));for(let t=e[0];t<=o[0]-1;t++)document.getElementById("arrows").appendChild(a.createArrowPiece("arrow/arrow_down_mid",[t,e[1]]));document.getElementById("arrows").appendChild(a.createArrowPiece("arrow/arrow_down_head",[o[0]-1,o[1]]))}else if(e[0]===o[0]&&e[1]>o[1]){document.getElementById("arrows").appendChild(a.createArrowPiece("arrow/arrow_left_head",o));for(let t=o[1];t<=e[1]-1;t++)document.getElementById("arrows").appendChild(a.createArrowPiece("arrow/arrow_left_mid",[e[0],t]));document.getElementById("arrows").appendChild(a.createArrowPiece("arrow/arrow_left_tail",[e[0],e[1]-1]))}else if(e[0]===o[0]&&e[1]<o[1]){document.getElementById("arrows").appendChild(a.createArrowPiece("arrow/arrow_right_tail",e));for(let t=e[1];t<=o[1]-1;t++)document.getElementById("arrows").appendChild(a.createArrowPiece("arrow/arrow_right_mid",[e[0],t]));document.getElementById("arrows").appendChild(a.createArrowPiece("arrow/arrow_right_head",[o[0],o[1]-1]))}else if(e[0]>o[0]&&e[1]<o[1]&&e[0]-o[0]==o[1]-e[1]){document.getElementById("arrows").appendChild(a.createArrowPiece("arrow/arrow_upright_head",[o[0],o[1]-1]));for(let t=o[0];t<=e[0]-1;t++)document.getElementById("arrows").appendChild(a.createArrowPiece("arrow/arrow_upright_mid",[t,o[1]+o[0]-1-t]));document.getElementById("arrows").appendChild(a.createArrowPiece("arrow/arrow_upright_tail",[e[0]-1,e[1]]))}else if(e[0]<o[0]&&e[1]>o[1]&&e[0]-o[0]==o[1]-e[1]){document.getElementById("arrows").appendChild(a.createArrowPiece("arrow/arrow_downleft_tail",[e[0],e[1]-1]));for(let t=e[0];t<=o[0]-1;t++)document.getElementById("arrows").appendChild(a.createArrowPiece("arrow/arrow_downleft_mid",[t,e[1]+e[0]-1-t]));document.getElementById("arrows").appendChild(a.createArrowPiece("arrow/arrow_downleft_head",[o[0]-1,o[1]]))}else if(e[0]>o[0]&&e[1]>o[1]&&e[0]-o[0]==e[1]-o[1]){document.getElementById("arrows").appendChild(a.createArrowPiece("arrow/arrow_upleft_head",o));for(let t=o[0];t<=e[0]-1;t++)document.getElementById("arrows").appendChild(a.createArrowPiece("arrow/arrow_upleft_mid",[t,o[1]-o[0]+t]));document.getElementById("arrows").appendChild(a.createArrowPiece("arrow/arrow_upleft_tail",[e[0]-1,e[1]-1]))}else{if(!(e[0]<o[0]&&e[1]<o[1]&&e[0]-o[0]==e[1]-o[1]))throw new Error("unsupported direction for the arrow");document.getElementById("arrows").appendChild(a.createArrowPiece("arrow/arrow_downright_tail",e));for(let t=e[0];t<=o[0]-1;t++)document.getElementById("arrows").appendChild(a.createArrowPiece("arrow/arrow_downright_mid",[t,e[1]-e[0]+t]));document.getElementById("arrows").appendChild(a.createArrowPiece("arrow/arrow_downright_head",[o[0]-1,o[1]-1]))}}(e,o),await new Promise((e=>setTimeout(e,2e3*.8093))),l.displayCiurl(t,r.Side.Downward),await new Promise((e=>setTimeout(e,485.58))),l.removeChildren(document.getElementById("arrows"))}(e.step,e.plannedDirection,e.stepping_ciurl);const w=await e.finalResult,E=n.fromAbsoluteCoord(w.dest),[A,y]=E,T=n.GAME_STATE.f.currentBoard[A][y];if(null===T||r.coordEq(e.src,E)){if(await c(m,606.975,i.coordToPieceXY(E),i.coordToPieceXY(e.src)),w.water_entry_ciurl&&(await l.animateWaterEntryLogo(),l.displayCiurl(w.water_entry_ciurl,r.Side.Downward),await new Promise((e=>setTimeout(e,500*.8093))),w.water_entry_ciurl.filter((e=>e)).length<3))return alert(s.DICTIONARY.ja.failedWaterEntry),console.log("drawField opponent #",14),n.GAME_STATE.last_move_focus=[o,t],l.drawField({focus:[o,t]}),w;r.coordEq(e.src,E)||(n.GAME_STATE.f.currentBoard[o][t]=null,n.GAME_STATE.f.currentBoard[A][y]=p),console.log("drawField opponent #",15),n.GAME_STATE.last_move_focus=[A,y],l.drawField({focus:[A,y]})}else{const a=document.getElementById(`field_piece_${A}_${y}`);if(await c(m,606.975,i.coordToPieceXY(E),i.coordToPieceXY(e.src)),await new Promise((e=>setTimeout(e,242.79))),await c(a,606.975,i.indToHo1Zuo1OfDownward(n.GAME_STATE.f.hop1zuo1OfDownward.length),i.coordToPieceXY([A,y]),"50",180),w.water_entry_ciurl&&(await l.animateWaterEntryLogo(),l.displayCiurl(w.water_entry_ciurl,r.Side.Downward),await new Promise((e=>setTimeout(e,500*.8093))),w.water_entry_ciurl.filter((e=>e)).length<3))return alert(s.DICTIONARY.ja.failedWaterEntry),console.log("drawField opponent #",12),n.GAME_STATE.last_move_focus=[o,t],l.drawField({focus:[o,t]}),w;r.coordEq(e.src,E)||(u(T),n.GAME_STATE.f.currentBoard[o][t]=null,n.GAME_STATE.f.currentBoard[A][y]=p),console.log("drawField opponent #",13),n.GAME_STATE.last_move_focus=[A,y],l.drawField({focus:[A,y]})}return w},o.animateOpponentSrcDst=async function(e){const o=n.fromAbsoluteCoord(e.src),t=n.fromAbsoluteCoord(e.dest);e.water_entry_ciurl?await _(o,t,{water_entry_ciurl:e.water_entry_ciurl}):await _(o,t,{})},o.animateOpponentFromHand=async function(e,o){const t=n.GAME_STATE.f.hop1zuo1OfDownward.findIndex((o=>o.color===e.color&&o.prof===e.prof));if(-1===t)throw new Error("What should exist in the hand does not exist");const[r]=n.GAME_STATE.f.hop1zuo1OfDownward.splice(t,1),[a,s]=o;if(null!==n.GAME_STATE.f.currentBoard[a][s])throw new Error("Trying to parachute the piece onto an occupied space");const d=document.getElementById(`hop1zuo1OfDownward_${t}`);await c(d,1213.95,i.coordToPieceXY([a,s]),i.indToHo1Zuo1OfDownward(t)),n.GAME_STATE.f.currentBoard[a][s]=r,console.log("drawField opponent #",24),n.GAME_STATE.last_move_focus=[a,s],l.drawField({focus:[a,s]})},o.animateOpponentTamNoStep=async function(e,o,t){const r=n.GAME_STATE.f.currentBoard[e[0]][e[1]];if(null===r)throw new Error("src is unoccupied");const a=document.getElementById(`field_piece_${e[0]}_${e[1]}`);await c(a,1213.95,i.coordToPieceXY(o),i.coordToPieceXY(e)),n.GAME_STATE.f.currentBoard[e[0]][e[1]]=null,n.GAME_STATE.f.currentBoard[o[0]][o[1]]=r,console.log("drawField opponent #",25),l.drawField({focus:null});const s=document.getElementById(`field_piece_${o[0]}_${o[1]}`);await new Promise((e=>setTimeout(e,242.79))),await c(s,1213.95,i.coordToPieceXY(t),i.coordToPieceXY(o)),n.GAME_STATE.f.currentBoard[o[0]][o[1]]=null,n.GAME_STATE.f.currentBoard[t[0]][t[1]]=r,console.log("drawField opponent #",26),n.GAME_STATE.last_move_focus=[t[0],t[1]],l.drawField({focus:[t[0],t[1]]})},o.animateOpponentTamSteppingDuringFormer=async function(e){await p(e.src,e.step,e.firstDest),await new Promise((e=>setTimeout(e,242.79))),await _(e.firstDest,e.secondDest,{})},o.animateOpponentTamSteppingDuringLatter=async function(e){await _(e.src,e.firstDest,{disable_focus:!0}),await new Promise((e=>setTimeout(e,242.79))),await p(e.firstDest,e.step,e.secondDest)}},460:(e,o,t)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.toPath_=o.toPath=void 0;const r=t(974),n=t(892);function i(e){return`${i=e.side,i===n.Side.Downward?"piece_rev":i===n.Side.Upward?"piece":i}/${t=e.color,t===r.Color.Huok2?"b":t===r.Color.Kok1?"r":t}${o=e.prof,o===r.Profession.Dau2?"dau":o===r.Profession.Gua2?"gua":o===r.Profession.Io?"io":o===r.Profession.Kauk2?"kauk":o===r.Profession.Kaun1?"kaun":o===r.Profession.Kua2?"kua":o===r.Profession.Maun1?"maun":o===r.Profession.Nuak1?"nuak":o===r.Profession.Tuk2?"tuk":o===r.Profession.Uai1?"uai":o}`;var o,t,i}o.toPath=i,o.toPath_=function(e){return"Tam2"===e?"piece/tam":i(e)}},462:(e,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.filterInOneDirectionTillCiurlLimit=void 0,o.filterInOneDirectionTillCiurlLimit=function(e,o,t,r){return e.filter((function(e){const n=function([e,t]){const[r,n]=o;return[e-r,t-n]},i=r.filter((e=>e)).length,[a,l]=n(e),[s,d]=n(t);return a*d-s*l==0&&a*s+l*d>0&&Math.max(Math.abs(a),Math.abs(l))<=i}))}},798:(e,o,t)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.drawScoreDisplay=o.drawFinalScoreDisplay=void 0;const r=t(431);function n(e){if(e%1!=0)throw new Error("non-integer");if(e>=200){const o=e%100==0?[]:i(e%100);return[...i(Math.floor(e/100)),"num100",...o]}if(e>=100)return["num100",...e%100==0?[]:n(e%100)];if(e<0)return["neg",...n(-e)];if(0==e)return["num00"];const o=e%10==0?[]:["num0"+e%10];return e>=20?[`num0${Math.floor(e/10)}`,"num10",...o]:e>=10?["num10",...o]:o}function i(e){if(e%1!=0)throw new Error("non-integer");if(e>=100)throw new Error("100 or more detected in toDigitsSub");if(e<=0)throw new Error("0 or less detected in toDigitsSub");if(e%10==0){if(e>=20)return[`num0${Math.floor(e/10)}`,"num10"];if(10==e)return["num10"];throw new Error("cannot happen")}{const o="num0"+e%10;return e>=20?[`num0${Math.floor(e/10)}`,o]:e>=10?["num10",o]:[o]}}function a(e,o,t,r){return r.map(((r,n)=>`<img\n        src="image/dat2/${r}.png"\n        style="position:absolute; left: ${e}px; top: ${.94*t*n+o}px;" width="${t}"\n    >`)).join("")}function l(e){const o=n(e);return a(20,234-70*o.length/2,70,o)}o.drawFinalScoreDisplay=function(e){const o=(e,o)=>a(530-60*o,23.5*(2-n(e).length)+239,50,n(e)),t=[].concat(...e),r=20+t.reduce(((e,o)=>e+o),0),i=document.getElementById("final_score_display");i.classList.remove("nocover"),i.innerHTML=Array.from({length:e.length}).map(((o,t)=>`<img style="position:absolute; left: ${530-60*[].concat(...e.slice(0,t)).length}px; top: 15px;" src="image/season_${t}.png" width="50">`)).join("")+t.map(((e,t)=>o(e,t))).join("")+o(20,-1)+l(r)},o.drawScoreDisplay=function(e){const o=e.sort(((e,o)=>{const t=["同色無抗行処","無抗行処","同色筆兵無傾","筆兵無傾","同色地心","地心","同色馬弓兵","馬弓兵","同色行行","行行","王","同色獣","獣","同色戦集","戦集","同色助友","助友","同色闇戦之集","闇戦之集","撃皇","皇再来"];return t.indexOf(e)-t.indexOf(o)}));if(o.length>11)throw new Error("too many hands");const t=[550,550,550,550,550,550,550,550,550,575,585,595][o.length],i=[60,60,60,60,60,60,60,60,60,57,53,49][o.length],s=document.getElementById("score_display");s.classList.remove("nocover");const d=o.map((e=>r.hand_to_score[e])).reduce(((e,o)=>e+o),0);s.innerHTML=o.map(((e,o)=>function(e,o){const t=n(r.hand_to_score[e]);let i="";return"同色"===e.slice(0,2)?i+=`\n        <img src="image/dat2/${e.slice(2)}.png" style="position:absolute; left: ${o}px; top: 15px;" width="50">\n        <img src="image/dat2/同色.png" style="position:absolute; left: ${o}px; top: 200px;" width="50">`:i+=`<img src="image/dat2/${e}.png" style="position:absolute; left: ${o}px; top: 15px;" width="50">`,i+=a(o,295,50,t),i}(e,t-i*o))).join("")+l(d)}}},o={};function t(r){var n=o[r];if(void 0!==n)return n.exports;var i=o[r]={exports:{}};return e[r].call(i.exports,i,i.exports,t),i.exports}(()=>{const e=t(519),o=t(513),r=t(204);console.log("drawField #",0),e.drawField({focus:null}),r.KIAR_ARK.header=[...r.KIAR_ARK.header,{type:"header",dat:`{始時:${(new Date).toISOString()}}`}],document.getElementById("kait_kaik_button").addEventListener("click",(()=>{document.getElementById("kait_kaik").classList.add("nocover"),o.GAME_STATE.is_my_turn=JSON.parse(sessionStorage.is_first_move_my_move),r.KIAR_ARK.header=[...r.KIAR_ARK.header,{type:"header",dat:`{一位色:${o.GAME_STATE.is_my_turn===o.GAME_STATE.IA_is_down?"黒":"赤"}}`}]})),"cpu"===sessionStorage.vs?document.getElementById("larta_opponent_img").innerHTML='<img src="image/nystiper2.png">':"someone"===sessionStorage.vs?document.getElementById("larta_opponent_img").innerHTML='<img src="image/larta2.png">':location.href="entrance.html"})()})();